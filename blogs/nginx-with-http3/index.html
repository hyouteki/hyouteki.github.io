<!doctype html><html lang=en><head><meta charset=utf-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#5100ff name=theme-color><link href=https://hyouteki.github.io/blogs/nginx-with-http3/ rel=canonical><title>
     Compiling nginx with http3 - Ninthcircle
    
  </title><link href=https://hyouteki.github.io/style.css rel=stylesheet><link href=/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/site.webmanifest rel=manifest><link href=https://vmst.io/@hyouteki rel=me><meta content=Ninthcircle property=og:site_name><meta content="
     Compiling nginx with http3 - Ninthcircle
    " property=og:title><meta content=https://hyouteki.github.io/blogs/nginx-with-http3/ property=og:url><meta content="This blog provides a step-by-step guide to compiling Nginx with HTTP/3 (QUIC) support. It covers installing OpenSSL 3.x, building Nginx from source, and configuring it to enable HTTP/3. The guide also includes instructions for setting up SSL certificates, modifying Nginx’s configuration for QUIC, and verifying HTTP/3 functionality using Wireshark. This tutorial is designed for those looking to enhance their web server’s performance and security with the latest protocols." property=og:description><meta content=https://hyouteki.github.io/card.png property=og:image><meta content=summary_large_image property=twitter:card><body><header><nav><a href=https://hyouteki.github.io> <i class="bi bi-house"></i> Ninthcircle </a><ul><li><a href=https://hyouteki.github.io/blogs target=_blank> <i class="bi bi-journal-bookmark"></i> Blogs </a><li><a href=https://hyouteki.github.io/toys target=_blank> <i class="bi bi-joystick"></i> Toys </a><li><a href=https://hyouteki.github.io/projects target=_blank> <i class="bi bi-pc-display"></i> Projects </a><li><a href=https://hyouteki.github.io/writings target=_blank> <i class="bi bi-vector-pen"></i> Writings </a><li><a href=https://github.com/hyouteki target=_blank> <i class="bi bi-github"></i> </a><li><a href=https://www.linkedin.com/in/hyouteki/ target=_blank> <i class="bi bi-linkedin"></i> </a><li><a href=https://twitter.com/mainlakshayhoon target=_blank> <i class="bi bi-twitter-x"></i> </a></ul></nav></header><div class=container><h1>Compiling nginx with http3</h1><small> <time datetime=2024-09-10T00:00:00+00:00 pubdate>10 September 2024</time> <span>•</span> <ul class=tags><li><a class=tag href=https://hyouteki.github.io/tags/nginx/>nginx</a><li><a class=tag href=https://hyouteki.github.io/tags/http3/>http3</a><li><a class=tag href=https://hyouteki.github.io/tags/webserver/>webserver</a><li><a class=tag href=https://hyouteki.github.io/tags/blog/>blog</a></ul> </small><p>This blog provides a step-by-step guide to compiling Nginx with HTTP/3 (QUIC) support. It covers installing OpenSSL 3.x, building Nginx from source, and configuring it to enable HTTP/3. The guide also includes instructions for setting up SSL certificates, modifying Nginx’s configuration for QUIC, and verifying HTTP/3 functionality using Wireshark. This tutorial is designed for those looking to enhance their web server’s performance and security with the latest protocols.<h2 id=install-openssl-3-x-or-later>Install OpenSSL 3.x or Later</h2><p>Nginx 1.26.2 comes bundled with OpenSSL 1.1.1f by default, which lacks QUIC support. Nginx’s QUIC support begins with OpenSSL 3.0. <br> Download and extract OpenSSL 3.0.8, then proceed to build and install it.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"> https://www.openssl.org/source/openssl-3.0.8.tar.gz</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">tar</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>xzf</span> openssl-3.0.8.tar.gz</span>
<span class="z-meta z-function-call z-shell"><span class="z-support z-function z-cd z-shell">cd</span></span><span class="z-meta z-function-call z-arguments z-shell"> openssl-3.0.8</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">./config</span></span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">make</span></span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> make install</span>
<span class="z-meta z-function-call z-shell"><span class="z-support z-function z-cd z-shell">cd</span></span><span class="z-meta z-function-call z-arguments z-shell"> ..</span>
</span></code></pre><h2 id=build-nginx-1-26-x-with-openssl-3-x>Build Nginx 1.26.x with OpenSSL 3.x</h2><p>After downloading the Nginx source code, extract the contents and prepare for configuration.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"> http://nginx.org/download/nginx-1.26.2.tar.gz</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">tar</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>xzf</span> nginx-1.26.2.tar.gz</span>
<span class="z-meta z-function-call z-shell"><span class="z-support z-function z-cd z-shell">cd</span></span><span class="z-meta z-function-call z-arguments z-shell"> nginx-1.26.2</span>
</span></code></pre><p>Rebuild Nginx using OpenSSL 3.x by specifying the appropriate configuration flags.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">./configure</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>prefix</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/etc/nginx<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>sbin-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/usr/sbin/nginx <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>modules-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/usr/lib/nginx/modules <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>conf-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/etc/nginx/nginx.conf <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>error-log-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/log/nginx/error.log <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>http-log-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/log/nginx/access.log <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>pid-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/run/nginx.pid <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>lock-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/run/nginx.lock <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>http-client-body-temp-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/cache/nginx/client_temp <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>http-proxy-temp-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/cache/nginx/proxy_temp <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>http-fastcgi-temp-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/cache/nginx/fastcgi_temp <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>http-uwsgi-temp-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/cache/nginx/uwsgi_temp <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>http-scgi-temp-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/cache/nginx/scgi_temp <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>with-http_ssl_module</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>with-http_v2_module</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>with-http_v3_module</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>with-openssl</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>../openssl-3.0.8</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">make</span></span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> make install</span>
</span></code></pre><p>Verify the Nginx build configuration with <code>nginx -V</code>.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nginx</span></span><span class="z-meta z-function-call z-arguments z-shell"> version: nginx/1.26.2</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">built</span></span><span class="z-meta z-function-call z-arguments z-shell"> by gcc 9.4.0 (Ubuntu 9.4.0-1ubuntu1<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>20.04.2</span><span class="z-meta z-function-call z-shell"></span>)
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">built</span></span><span class="z-meta z-function-call z-arguments z-shell"> with OpenSSL 3.0.8 7 Feb 2023</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">TLS</span></span><span class="z-meta z-function-call z-arguments z-shell"> SNI support enabled</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">configure</span></span><span class="z-meta z-function-call z-arguments z-shell"> arguments: <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>prefix</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/etc/nginx<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>sbin-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/usr/sbin/nginx <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>modules-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/usr/lib/nginx/modules <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>conf-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/etc/nginx/nginx.conf <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>error-log-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/log/nginx/error.log <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>http-log-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/log/nginx/access.log <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>pid-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/run/nginx.pid <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>lock-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/run/nginx.lock <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>http-client-body-temp-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/cache/nginx/client_temp <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>http-proxy-temp-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/cache/nginx/proxy_temp <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>http-fastcgi-temp-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/cache/nginx/fastcgi_temp <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>http-uwsgi-temp-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/cache/nginx/uwsgi_temp <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>http-scgi-temp-path</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/cache/nginx/scgi_temp <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>with-http_ssl_module</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>with-http_v2_module</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>with-http_v3_module</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>with-openssl</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>../openssl-3.0.8</span>
</span></code></pre><h2 id=edit-nginx-configuration>Edit nginx configuration</h2><p>Modify the Nginx configuration file to enable HTTP/3 and set up the server’s SSL certificates. The configuration file is located at <code>/etc/nginx/nginx.conf</code>.<ul><li>Adjust the server block to listen on port 443 for both QUIC and SSL connections.<li>Specify the root directory and set up file paths for serving content, enabling auto-indexing.<li>Add the HTTP/3 Alt-Svc header to enable QUIC connections.</ul><pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">events </span>{
<span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">worker_connections</span>  </span><span class="z-constant z-numeric z-genconfig">1024</span>;
}

<span class="z-storage z-type z-genconfig">http </span>{
<span class="z-storage z-type z-genconfig">    server </span>{
<span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">listen</span> </span><span class="z-constant z-numeric z-genconfig">443</span> quic reuseport;
<span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">listen</span> </span><span class="z-constant z-numeric z-genconfig">443</span> ssl;

<span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">ssl_certificate</span>       </span><span class="z-keyword z-operator z-genconfig"><</span><span class="z-support z-constant z-genconfig">ADD_YOUR_CRT</span><span class="z-keyword z-operator z-genconfig">></span>;
<span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">ssl_certificate_key</span>   </span><span class="z-keyword z-operator z-genconfig"><</span><span class="z-support z-constant z-genconfig">ADD_YOUR_KEY</span><span class="z-keyword z-operator z-genconfig">></span>;
<span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">ssl_protocols</span> </span>TLSv1 TLSv1<span class="z-keyword z-operator z-genconfig">.</span><span class="z-constant z-numeric z-genconfig">1</span> TLSv1<span class="z-keyword z-operator z-genconfig">.</span><span class="z-constant z-numeric z-genconfig">2</span> TLSv1<span class="z-keyword z-operator z-genconfig">.</span><span class="z-constant z-numeric z-genconfig">3</span>;

<span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">root</span>                  </span><span class="z-keyword z-operator z-genconfig"><</span><span class="z-support z-constant z-genconfig">ADD_YOUR_ROOT</span><span class="z-keyword z-operator z-genconfig">></span>;
<span class="z-keyword z-other z-genconfig">        index</span> index<span class="z-keyword z-operator z-genconfig">.</span>html index<span class="z-keyword z-operator z-genconfig">.</span>htm;

<span class="z-keyword z-other z-genconfig">        location</span> <span class="z-keyword z-operator z-genconfig">/</span> {
<span class="z-meta z-param z-genconfig">                <span class="z-variable z-parameter z-genconfig">root</span>          </span><span class="z-keyword z-operator z-genconfig"><</span><span class="z-support z-constant z-genconfig">ADD_YOUR_ROOT</span><span class="z-keyword z-operator z-genconfig">></span>;
<span class="z-meta z-param z-genconfig">                <span class="z-variable z-parameter z-genconfig">autoindex</span> </span><span class="z-constant z-language z-genconfig">on</span>;
<span class="z-meta z-param z-genconfig">                <span class="z-variable z-parameter z-genconfig">try_files</span> </span><span class="z-storage z-source z-genconfig">$uri</span> <span class="z-storage z-source z-genconfig">$uri</span><span class="z-keyword z-operator z-genconfig">/</span> <span class="z-keyword z-operator z-genconfig">=</span><span class="z-constant z-numeric z-genconfig">404</span>;
        }

<span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">add_header</span> </span>alt<span class="z-keyword z-operator z-genconfig">-</span>svc <span class="z-string z-quoted z-signle z-genconfig">'h3=":443"; ma=86400'</span>;
    }
}
</span></code></pre><p>Save the changes, test the configuration, and start Nginx.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nginx</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span></span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> systemctl start nginx</span>
</span></code></pre><p>Verify HTTP/3 and QUIC functionality using Wireshark to capture and analyze network traffic, ensuring that the connection traces indicate QUIC support. <img alt=wireshark src=https://hyouteki.github.io/blogs/nginx-with-http3/./wireshark.png><blockquote><p>The IPs are masked for obvious reasons. But we can see traces of QUIC connection, which means http3 is working.</blockquote><hr><nav class=post-nav><a class="post-nav-item post-nav-next" href=https://hyouteki.github.io/blogs/alpine-qemu/> <div class=nav-arrow>Next →</div> <span class=post-title>Alpine Linux on QEMU with Persistent Storage</span> </a></nav><p class=dialog-buttons><a class=inline-button href=#top>Go to top</a> <a class="inline-button colored" href=https://github.com/hyouteki/hyouteki.github.io/issues>File an issue</a></div><footer class=footer><p title="Last built at 2025-02-10 16:16 +00:00"><small>© Ninthcircle, 2025</small><p><small>Powered by <a href=https://www.getzola.org>Zola</a> and <a href=https://daudix.codeberg.page/duckquill>Duckquill</a></small></footer>